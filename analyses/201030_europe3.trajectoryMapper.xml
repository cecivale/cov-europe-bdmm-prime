<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core
                  :beast.core.parameter
                  :beast.evolution.alignment
                  :beast.evolution.tree
                  :feast.expressions
                  :feast.function
                  :feast.fileio
                  :feast.fileio.logfileiterator
                  :bdmmprime.distribution
                  :bdmmprime.parameterization
                  :bdmmprime.mapping" version="2.0">


  <!-- Alignment-->
  <data
  id="europe_demes"
  spec= "AlignmentFromFasta"
  fileName = "final_alignment.fasta"  
  name="alignment"/>

  <!-- Modify parameterization to match the one from the analysis-->
  <distribution id="BDMMPrime" spec="BirthDeathMigrationDistribution" conditionOnSurvival="false" tree="@tree"> 
    <parameterization id="EpiBDMMPrimeParameterization" spec="EpiParameterization" origin="@origin">
      <R0 spec="SkylineVectorParameter" typeSet="@typeSet">
        <skylineValues idref="R0"/>
      </R0>
      <R0AmongDemes spec="SkylineMatrixParameter" typeSet="@typeSet">
        <skylineValues idref="R0AmongDemes"/>
      </R0AmongDemes>
      <becomeUninfectiousRate spec="SkylineVectorParameter" typeSet="@typeSet">
        <skylineValues idref="becomeUninfectiousRate"/>
      </becomeUninfectiousRate>
      <samplingProportion spec="SkylineVectorParameter" typeSet="@typeSet" timesAreAges="true" origin="@origin">
        <skylineValues idref="samplingProportion"/>
        <parameter id="samplingProportionChangeTimes" spec="RealParameter" name="changeTimes">0.12 0.205</parameter>
      </samplingProportion>
      <rhoSampling spec="TimedParameter" id="rhoSamplingProb" typeSet="@typeSet"/>
      <removalProb spec="SkylineVectorParameter" typeSet="@typeSet">
        <skylineValues idref="removalProb"/>
      </removalProb>
      <migrationRate spec="SkylineMatrixParameter" typeSet="@typeSet">
        <skylineValues idref="migrationRate"/>
      </migrationRate>
      <typeSet id="typeSet" spec="bdmmprime.parameterization.TypeSet">
        <typeTraitSet id="typeTraitSet" spec="TraitSetFromTaxonSet" traitname="type" delimiter="/" takeGroup="1"> 
          <taxa id="TaxonSet.1" spec="TaxonSet" alignment="@europe_demes"/> 
        </typeTraitSet>
      </typeSet>
    </parameterization>
    <parameter id="typeFrequencies" spec="RealParameter" dimension="6" estimate="false" lower="0.0" name="frequencies" upper="1.0">0.0 0.0 1.0 0.0 0.0 0.0</parameter> 
    <typeTraitSet idref="typeTraitSet"/>
  </distribution>

  
   <run spec="LogFileIterator">
    <!-- Trace log for the analysis-->
    <logFileState spec="TraceLogFileState" logFileName="$(filebase)_comb.thinned.log">

      <logFileEntry spec="LogFileRealParameter" fieldName="originBDMMPrime">
        <fieldParameter id="origin" spec="RealParameter" value="1.0"/>
      </logFileEntry>

       <!-- R0 -->
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVFrance" fieldParameterIndex="0">
        <fieldParameter id="R0" spec="RealParameter" value="0.0 0.0 0.0 0.0 0.0 0.0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVGermany" fieldParameterIndex="1">
        <fieldParameter idref="R0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVHubei-China" fieldParameterIndex="2">
        <fieldParameter idref="R0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVItaly" fieldParameterIndex="3">
        <fieldParameter idref="R0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVOtherEuropean" fieldParameterIndex="4">
        <fieldParameter idref="R0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="R0SVSpain" fieldParameterIndex="5">
        <fieldParameter idref="R0"/>
      </logFileEntry>

      <logFileEntry spec="LogFileRealParameter" fieldName="R0AmongDemesSM">
        <fieldParameter id="R0AmongDemes" spec="RealParameter" value="0.0" />
      </logFileEntry>

      <logFileEntry spec="LogFileRealParameter" fieldName="becomeUninfectiousRateSV">
        <fieldParameter id="becomeUninfectiousRate" spec="RealParameter" value="36.5"/>
      </logFileEntry>

      <!-- Migration rates -->
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMFrance_to_Germany" fieldParameterIndex="0">
        <fieldParameter id="migrationRate" spec="RealParameter" value="0.1 0.0 0.1 0.1 0.1 0.1 0.0 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.0 0.1 0.1 0.1 0.1 0.0 0.1 0.1 0.1 0.1 0.0 0.1 0.1"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMFrance_to_Hubei-China" fieldParameterIndex="1">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMFrance_to_Italy" fieldParameterIndex="2">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMFrance_to_OtherEuropean" fieldParameterIndex="3">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMFrance_to_Spain" fieldParameterIndex="4">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMGermany_to_France" fieldParameterIndex="5">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMGermany_to_Hubei-China" fieldParameterIndex="6">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMGermany_to_Italy" fieldParameterIndex="7">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMGermany_to_OtherEuropean" fieldParameterIndex="8">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
       <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMGermany_to_Spain" fieldParameterIndex="9">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMHubei-China_to_France" fieldParameterIndex="10">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMHubei-China_to_Germany" fieldParameterIndex="11">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMHubei-China_to_Italy" fieldParameterIndex="12">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMHubei-China_to_OtherEuropean" fieldParameterIndex="13">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMHubei-China_to_Spain" fieldParameterIndex="14">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMItaly_to_France" fieldParameterIndex="15">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMItaly_to_Germany" fieldParameterIndex="16">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMItaly_to_Hubei-China" fieldParameterIndex="17">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMItaly_to_OtherEuropean" fieldParameterIndex="18">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMItaly_to_Spain" fieldParameterIndex="19">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMOtherEuropean_to_France" fieldParameterIndex="20">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMOtherEuropean_to_Germany" fieldParameterIndex="21">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMOtherEuropean_to_Hubei-China" fieldParameterIndex="22">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMOtherEuropean_to_Italy" fieldParameterIndex="23">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
       <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMOtherEuropean_to_Spain" fieldParameterIndex="24">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMSpain_to_France" fieldParameterIndex="25">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMSpain_to_Germany" fieldParameterIndex="26">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMSpain_to_Hubei-China" fieldParameterIndex="27">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMSpain_to_Italy" fieldParameterIndex="28">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>
       <logFileEntry spec="LogFileRealParameter" fieldName="migrationRateSMSpain_to_OtherEuropean" fieldParameterIndex="29">
        <fieldParameter idref="migrationRate"/>
      </logFileEntry>

      <!-- Sampling Proportions -->
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_France" fieldParameterIndex="0">
        <fieldParameter id="samplingProportion" spec="RealParameter" value="1.0E-5 1.0E-5 0.0 1.0E-5 1.0E-5 1.0E-5 1.0E-5 1.0E-5 1.0E-5 1.0E-5 1.0E-5 1.0E-5 0.0 0.0 0.0 0.0 0.0 0.0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_Germany" fieldParameterIndex="1">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_Hubei-China" fieldParameterIndex="2">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_Italy" fieldParameterIndex="3">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_OtherEuropean" fieldParameterIndex="4">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
       <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi2_Spain" fieldParameterIndex="5">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_France" fieldParameterIndex="6">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_Germany" fieldParameterIndex="7">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_Hubei-China" fieldParameterIndex="8">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_Italy" fieldParameterIndex="9">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_OtherEuropean" fieldParameterIndex="10">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi1_Spain" fieldParameterIndex="11">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_France" fieldParameterIndex="12">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_Germany" fieldParameterIndex="13">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_Hubei-China" fieldParameterIndex="14">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_Italy" fieldParameterIndex="15">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_OtherEuropean" fieldParameterIndex="16">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportionSVi0_Spain" fieldParameterIndex="17">
        <fieldParameter idref="samplingProportion"/>
      </logFileEntry>

      <logFileEntry spec="LogFileRealParameter" fieldName="removalProbSV">
        <fieldParameter id="removalProb" spec="RealParameter" value="0.0"/>
      </logFileEntry>

    </logFileState>

    <!-- Tree log for the analysis-->
    <logFileState spec="TreeLogFileState" logFileName="$(filebase)_comb.thinned.trees">
      <tree spec="Tree" id="tree"/>
    </logFileState>

    <logger spec="Logger"
            logEvery="10000">
      <log idref="R0"/>
      <log idref="samplingProportion"/>
    </logger>

    <!-- Typed tree log-->
    <logger spec="Logger" fileName="$(filebase).typed.trees" logEvery="10000" mode="tree">
        <log id="typeMappedTree" spec="TypeMappedTree" bdmmDistrib="@BDMMPrime" frequencies="@typeFrequencies" mapOnInit="false" remapOnLog="true" typeLabel="type" typeTraitSet="@typeTraitSet" untypedTree="@tree"/>
    </logger>

    <!-- Typed node tree log-->
    <logger id="nodeTypedTreeLogger" spec="Logger" fileName="$(filebase).typed.node.trees" logEvery="10000" mode="tree">
      <log id="nodeTypedTree" spec="TypedNodeTreeLogger" typedTree="@typeMappedTree"/>
    </logger>

    <!-- Trajectories log-->
    <logger spec="Logger" logEvery="10000" fileName="$(filebase).TL.traj">
      <log id="typedTrajectoryTL" spec="bdmmprime.trajectories.SampledTrajectory"
           nParticles="1000"
           useTauLeaping="true"
           minLeapCount="100"
           epsilon="0.03"
           typeLabel="type"
           typeMappedTree="@typeMappedTree"
           parameterization="@EpiBDMMPrimeParameterization"/>
    </logger>
  </run>
</beast>

